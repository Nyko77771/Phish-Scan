{"version":3,"file":"content.js","mappings":";;;;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AAOA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAEA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://phishscan/./src/content.js"],"sourcesContent":["// Initial Popup Response Handling\n// variable for initial url\nlet lastUrl = location.href;\n\n// Controller function for detecting url changes\nfunction urlDetectionController() {\n  //Getting the current URL\n  currentUrl = window.location.href;\n\n  //Checking if current is different from last URL's\n  if (currentUrl != lastUrl) {\n    console.log(`Content: URL Changed`);\n    console.log(`Content: Old URL: ${lastUrl}`);\n    console.log(`Content: New URL: ${currentUrl}`);\n    //Setting last URL to be the new/current URL\n    lastUrl = currentUrl;\n    //Calling on emailOpenController to check Service and Email\n    emailOpenController(currentUrl);\n  }\n}\n\n// function for detecting email services and if email is opened\nfunction emailOpenController(providedUrl) {\n  const url = providedUrl;\n\n  //Defining Service and Email variables\n  let emailServiceDetected = false;\n  let emailOpenedCheck = false;\n\n  //Temporal Solution\n  //Checking for Big Email service\n  if (\n    url.includes(\"mail.google.com\") ||\n    url.includes(\"outlook.office365.com\") ||\n    url.includes(\"outlook.live.com\") ||\n    url.includes(\"mail.yahoo.com\") ||\n    url.includes(\"icloud.com/mail/\")\n  ) {\n    //If Present then make service found true\n    emailServiceDetected = true;\n    console.log(`Content: Service detected`);\n  }\n\n  //If Service is detected then check if email is opened\n  if (emailServiceDetected) {\n    console.log(\"Content: Opened Email Service\");\n\n    //Checking for Gmail\n    if (\n      url.includes(\"mail.google.com/mail/u/0/\") &&\n      url.match(/#inbox\\/[a-zA-Z0-9]+/)\n    ) {\n      emailOpenedCheck = true;\n      console.log(`Gmail: Email opened`);\n      scanPage();\n    }\n    //Checking for Outlook\n    /*\n    ###############################\n    Need to be fix below services\n    ###############################\n    */\n    if (\n      (url.includes(\"outlook.office365.com/mail/\") ||\n        url.includes(\"outlook.live.com/mail/\")) &&\n      (url.match(/\\/mail\\/inbox\\/id\\/[a-zA-Z0-9]+/) ||\n        url.match(/\\/mail\\/[0-9]+\\/sentiments\\/id\\/[a-zA-Z0-9]+/))\n    ) {\n      emailOpenedCheck = true;\n      console.log(`Outlook: Email opened`);\n    }\n    // Checking for Yahoo\n    if (url.includes(\"mail.yahoo.com\") && url.includes(\"/d/message/\")) {\n      emailOpenedCheck = true;\n      console.log(`YahooMail: Email opened`);\n    }\n    // Checking Icloud\n    if (\n      url.includes(\"icloud.com/mail\") &&\n      url.match(/#.*\\/message\\/[a-zA-Z0-9]+/)\n    ) {\n      emailOpenedCheck = true;\n      console.log(`Apple: Email opened`);\n    }\n  }\n\n  console.log(\n    `Is service: ${emailServiceDetected}\\nEmail opened: ${emailOpenedCheck}`\n  );\n\n  //Sending results of checks to background\n  chrome.runtime.sendMessage({\n    message: \"updateStatus\",\n    emailServiceDetected,\n    emailOpenedCheck,\n    url,\n  });\n}\n\n//Function pageStateCheck was created using some advice found on StackOverflow.\n//This function tracks the changes in the state of tabs\n/***************************************************************************************\n *    Title: How to detect if URL has changed after hash in JavaScript\n *    Author: aljgom\n *    Date: 15/10/2018\n *    Availability: https://stackoverflow.com/questions/6390341/how-to-detect-if-url-has-changed-after-hash-in-javascript\n *\n ***************************************************************************************/\n\nfunction pageStateCheck() {\n  // Creating variables for old state and its replacement\n  let oldPushState = history.pushState;\n  let oldReplaceState = history.replaceState;\n\n  //function for overriding the pushState\n  history.pushState = function pushState() {\n    oldPushState.apply(this, arguments);\n    //After change the urlDetectionController function is called\n    urlDetectionController();\n  };\n\n  //function for overriding the current state that replaced the previous one\n  history.replaceState = function replaceState() {\n    oldReplaceState.apply(this, arguments);\n    urlDetectionController();\n  };\n\n  //adding event listener to the window for when history changes\n  //triggers urlDetectionController function\n  window.addEventListener(\"popstate\", urlDetectionController);\n}\n\n// calling pageStateCheck\npageStateCheck();\n\n// calling urlDetection after a minute\nsetTimeout(urlDetectionController, 1000);\n\n// Email Page Scanning\n//Using listener for receiving scan request\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  if (request.action === \"scanPage\") {\n    console.log(\"Content: Performing scan\");\n    // Saving scan page results into results variable\n    const results = scanPage();\n    console.log(\"Content: Email scan completed\");\n\n    // Saving id from the request into tab ID variable\n    const tabId = request.tabId;\n    // Sending scan results back to background\n    sendResponse({ tabId: tabId, results: results });\n\n    return true;\n  }\n\n  if (request.action === \"highlightPage\") {\n    console.log(\"Content: Doing Highlight\");\n    const toHighlight = request.words;\n    const outcome = highlightResults(toHighlight);\n    if (outcome) {\n      sendResponse(outcome);\n    }\n    return true;\n  }\n});\n\n//Function for scanning email contents\nfunction scanPage() {\n  console.log(`Content: Starting scan`);\n\n  const emailContainer = document.querySelector(\".a3s\");\n\n  if (!emailContainer) {\n    console.log(`Content: No email body found`);\n    return {\n      emailText: [],\n      emailLinks: [],\n    };\n  }\n\n  //Defining different tags that hold text\n  const tags = [\"h1\", \"h2\", \"h3\", \"h4\", \"p\", \"span \", \"div\", \"a\"];\n\n  // Empty lists for storing text and links\n  var emailContent = [];\n  var emailLinks = [];\n\n  //Looping through each tag\n  tags.forEach((tag) => {\n    //Getting elements based on tag\n    const elements = emailContainer.querySelectorAll(tag);\n    // Looping through each element found\n    elements.forEach((element) => {\n      //Seeing if there is text inside the element\n      if (element.innerText) {\n        const text = element.innerText.trim();\n        //If there are are words then push them into emailContent list\n        if (text) {\n          emailContent.push(text);\n        }\n      }\n\n      if (element.tagName.toLowerCase() === \"a\" && element.href) {\n        emailLinks.push({ link: element.href, text: element.innerText.trim() });\n      }\n    });\n  });\n\n  console.log(`Content: Finished Email Scan`);\n\n  return {\n    emailText: emailContent,\n    emailLinks: emailLinks,\n  };\n}\n\n//Term Highlight\n// Function for highlighting the email page\nfunction highlightResults(words) {\n  //console.log(`These are words that need to be highlighted: ${words}`);\n  const terms = words;\n\n  if (terms.length === 0) {\n    alert(`Nothing to highlight!`);\n    return false;\n  }\n\n  const tags = [\"h1\", \"h2\", \"h3\", \"h4\", \"p\", \"span\", \"div\", \"a\"];\n\n  console.log(`Content: starting highlight`);\n  try {\n    terms.forEach((term) => {\n      tags.forEach((tag) => {\n        const elements = document.querySelectorAll(tag);\n        elements.forEach((element) => {\n          if (element.innerHTML.toLowerCase().includes(term.toLowerCase())) {\n            const regularExpression = new RegExp(`\\\\b${term}\\\\b`, \"gi\");\n            element.innerHTML = element.innerHTML.replaceAll(\n              regularExpression,\n              `<span style=\"background-color: yellow\">${term}</span>`\n            );\n          }\n        });\n      });\n    });\n    console.log(`Content: highlight is finished`);\n    return true;\n  } catch (error) {\n    console.log(`Content: Failed to highlight found terms. Error: ${error}`);\n    return false;\n  }\n}\n"],"names":[],"sourceRoot":""}